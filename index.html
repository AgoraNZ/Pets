<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Saskia's Ark - Modern Marketplace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Reset & base styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background: #f2f2f2; color: #333; }
    a { text-decoration: none; color: inherit; }
    
    /* Header & Navigation */
    header {
      background: #0073e6;
      color: #fff;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 { font-size: 1.8em; }
    nav a, nav button {
      margin: 0 8px;
      font-weight: 500;
      color: #fff;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1em;
    }
    nav button:hover, nav a:hover { text-decoration: underline; }
    
    /* Slider */
    .slider {
      position: relative;
      width: 100%;
      height: 400px;
      overflow: hidden;
    }
    .slide {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }
    .slide.active { opacity: 1; }
    .slide img { width: 100%; height: 100%; object-fit: cover; }
    
    /* Main content */
    main { padding: 20px; }
    
    /* Listing Grid */
    .listing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .listing-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    .listing-card:hover { transform: translateY(-5px); }
    .listing-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .listing-info {
      padding: 15px;
    }
    .listing-info h3 { font-size: 1.2em; margin-bottom: 8px; }
    .listing-info p { font-size: 0.9em; line-height: 1.4; }
    .listing-info .price {
      color: #0073e6;
      font-weight: bold;
      margin-top: 10px;
    }
    .listing-info .seller {
      font-style: italic;
      margin-top: 5px;
      font-size: 0.85em;
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 15px;
      font-size: 0.8em;
      color: #777;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Saskia's Ark</h1>
    <nav>
      <a href="#home">Home</a>
      <a href="#sell">Sell a Pet</a>
      <a href="#upload">Super Buyer Upload</a>
      <span id="authLinks">
        <a href="#login" id="loginLink">Login</a>
        <a href="#register" id="registerLink">Register</a>
      </span>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </nav>
  </header>
  
  <!-- Slider Section -->
  <div class="slider" id="slider">
    <div class="slide active"><img src="https://picsum.photos/seed/slider1/1200/400" alt="Featured Animal 1"></div>
    <div class="slide"><img src="https://picsum.photos/seed/slider2/1200/400" alt="Featured Animal 2"></div>
    <div class="slide"><img src="https://picsum.photos/seed/slider3/1200/400" alt="Featured Animal 3"></div>
    <div class="slide"><img src="https://picsum.photos/seed/slider4/1200/400" alt="Featured Animal 4"></div>
  </div>
  
  <main>
    <div id="content"></div>
    <!-- Listings Grid -->
    <div class="listing-grid" id="listingGrid"></div>
  </main>
  
  <footer>
    &copy; 2025 Pet TradeMe. All rights reserved.
  </footer>
  
  <script>
    // --- Slider Functionality ---
    const slides = document.querySelectorAll('.slide');
    let currentSlide = 0;
    setInterval(() => {
      slides[currentSlide].classList.remove('active');
      currentSlide = (currentSlide + 1) % slides.length;
      slides[currentSlide].classList.add('active');
    }, 4000);
    
    // --- LocalStorage Persistence ---
    function getUsers() {
      return JSON.parse(localStorage.getItem("users") || "[]");
    }
    function saveUsers(users) {
      localStorage.setItem("users", JSON.stringify(users));
    }
    function getPets() {
      return JSON.parse(localStorage.getItem("pets") || "[]");
    }
    function savePets(pets) {
      localStorage.setItem("pets", JSON.stringify(pets));
    }
    function getCurrentUser() {
      const userId = localStorage.getItem("currentUser");
      if (!userId) return null;
      return getUsers().find(u => u.id === userId);
    }
    function setCurrentUser(userId) {
      localStorage.setItem("currentUser", userId);
    }
    function clearCurrentUser() {
      localStorage.removeItem("currentUser");
    }
    function generateId() {
      return '_' + Math.random().toString(36).substr(2, 9);
    }
    
    // --- Navigation & Routing ---
    function updateNav() {
      const currentUser = getCurrentUser();
      document.getElementById("loginLink").style.display = currentUser ? "none" : "inline";
      document.getElementById("registerLink").style.display = currentUser ? "none" : "inline";
      document.getElementById("logoutBtn").style.display = currentUser ? "inline" : "none";
    }
    document.getElementById("logoutBtn").addEventListener("click", () => {
      clearCurrentUser();
      window.location.hash = "#home";
      render();
    });
    
    function render() {
      const hash = window.location.hash || "#home";
      const content = document.getElementById("content");
      content.innerHTML = "";
      updateNav();
      if (hash === "#home") {
        renderHome();
      } else if (hash === "#login") {
        renderLogin();
      } else if (hash === "#register") {
        renderRegister();
      } else if (hash === "#sell") {
        renderSellPet();
      } else if (hash === "#upload") {
        renderUpload();
      } else if (hash.startsWith("#pet-")) {
        const petId = hash.slice(5);
        renderPetDetail(petId);
      } else {
        content.innerHTML = "<p>Page not found.</p>";
      }
    }
    
    window.addEventListener("hashchange", render);
    
    // --- Views ---
    function renderHome() {
      const content = document.getElementById("content");
      content.innerHTML = "<h2>Featured Listings</h2>";
      renderListings();
    }
    
    function renderLogin() {
      const content = document.getElementById("content");
      content.innerHTML = `
        <h2>Login</h2>
        <form id="loginForm">
          <label>Email: <input type="email" name="email" required></label>
          <label>Password: <input type="password" name="password" required></label>
          <button type="submit">Login</button>
        </form>
        <div id="loginError" style="color:red;"></div>
      `;
      document.getElementById("loginForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const email = e.target.email.value;
        const password = e.target.password.value;
        const users = getUsers();
        const user = users.find(u => u.email === email && u.password === password);
        if (user) {
          setCurrentUser(user.id);
          window.location.hash = "#home";
          render();
        } else {
          document.getElementById("loginError").innerText = "Invalid credentials";
        }
      });
    }
    
    function renderRegister() {
      const content = document.getElementById("content");
      content.innerHTML = `
        <h2>Register</h2>
        <form id="registerForm">
          <label>Username: <input type="text" name="username" required></label>
          <label>Email: <input type="email" name="email" required></label>
          <label>Password: <input type="password" name="password" required></label>
          <button type="submit">Register</button>
        </form>
        <div id="registerError" style="color:red;"></div>
      `;
      document.getElementById("registerForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const username = e.target.username.value;
        const email = e.target.email.value;
        const password = e.target.password.value;
        const users = getUsers();
        if (users.find(u => u.email === email)) {
          document.getElementById("registerError").innerText = "User already exists";
          return;
        }
        const newUser = { 
          id: generateId(), 
          username, 
          email, 
          password, 
          superBuyer: false, 
          propertyPhoto: null 
        };
        users.push(newUser);
        saveUsers(users);
        setCurrentUser(newUser.id);
        window.location.hash = "#home";
        render();
      });
    }
    
    function renderSellPet() {
      const currentUser = getCurrentUser();
      if (!currentUser) {
        window.location.hash = "#login";
        render();
        return;
      }
      const content = document.getElementById("content");
      content.innerHTML = `
        <h2>Sell a Pet</h2>
        <form id="sellForm">
          <label>Name: <input type="text" name="name" required></label>
          <label>Type: <input type="text" name="type" required></label>
          <label>Breed: <input type="text" name="breed"></label>
          <label>Age: <input type="number" name="age"></label>
          <label>Description:<br><textarea name="description"></textarea></label>
          <label>Price: <input type="number" name="price" required></label>
          <button type="submit">Create Listing</button>
        </form>
        <div id="sellError" style="color:red;"></div>
      `;
      document.getElementById("sellForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const pet = {
          id: generateId(),
          name: e.target.name.value,
          type: e.target.type.value,
          breed: e.target.breed.value,
          age: e.target.age.value,
          description: e.target.description.value,
          price: e.target.price.value,
          sellerId: currentUser.id
        };
        const pets = getPets();
        pets.push(pet);
        savePets(pets);
        window.location.hash = "#home";
        render();
      });
    }
    
    function renderUpload() {
      const currentUser = getCurrentUser();
      if (!currentUser) {
        window.location.hash = "#login";
        render();
        return;
      }
      const content = document.getElementById("content");
      content.innerHTML = `
        <h2>Super Buyer Qualification</h2>
        <p>Upload a photo of your property so sellers can see where the pet will be going.</p>
        <form id="uploadForm">
          <input type="file" name="photo" accept="image/*" required><br>
          <button type="submit">Upload Photo</button>
        </form>
        <div id="uploadMsg"></div>
      `;
      document.getElementById("uploadForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const fileInput = e.target.photo;
        const file = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
          let users = getUsers();
          const userIndex = users.findIndex(u => u.id === currentUser.id);
          if (userIndex !== -1) {
            users[userIndex].propertyPhoto = event.target.result;
            users[userIndex].superBuyer = true;
            saveUsers(users);
            document.getElementById("uploadMsg").innerText = "Upload successful! You are now a Super Buyer.";
          }
        }
        reader.readAsDataURL(file);
      });
    }
    
    function renderPetDetail(petId) {
      const content = document.getElementById("content");
      const pets = getPets();
      const pet = pets.find(p => p.id === petId);
      if (!pet) {
        content.innerHTML = "<p>Pet not found.</p>";
        return;
      }
      const users = getUsers();
      const seller = users.find(u => u.id === pet.sellerId);
      content.innerHTML = `
        <h2>${pet.name}</h2>
        <p><strong>Type:</strong> ${pet.type}</p>
        <p><strong>Breed:</strong> ${pet.breed}</p>
        <p><strong>Age:</strong> ${pet.age}</p>
        <p><strong>Description:</strong> ${pet.description}</p>
        <p class="price"><strong>Price:</strong> \$${pet.price}</p>
        <p class="seller"><strong>Seller:</strong> ${seller ? seller.username : "Unknown"}</p>
        ${seller && seller.superBuyer && seller.propertyPhoto ? `<img src="${seller.propertyPhoto}" alt="Seller Property">` : ''}
        <p><a href="#home">Back to Listings</a></p>
      `;
    }
    
    // --- Pre-populate 20 Sample Listings (if none exist) ---
    function populateSampleListings() {
      if(getPets().length > 0) return; // Do not overwrite existing listings
      const sampleListings = [
        { id: generateId(), title: "Adorable Siamese Cat", type: "Cat", breed: "Siamese", age: 2, description: "A friendly Siamese cat looking for a loving home.", price: 150, sellerId: "sample1", image: "https://picsum.photos/seed/cat1/300/200" },
        { id: generateId(), title: "Playful Persian Cat", type: "Cat", breed: "Persian", age: 3, description: "Fluffy and affectionate, great companion.", price: 200, sellerId: "sample2", image: "https://picsum.photos/seed/cat2/300/200" },
        { id: generateId(), title: "Golden Retriever", type: "Dog", breed: "Golden Retriever", age: 4, description: "Loyal and friendly, perfect for families.", price: 500, sellerId: "sample3", image: "https://picsum.photos/seed/dog1/300/200" },
        { id: generateId(), title: "Charming Bulldog", type: "Dog", breed: "Bulldog", age: 3, description: "Strong and charming, a wonderful pet.", price: 450, sellerId: "sample4", image: "https://picsum.photos/seed/dog2/300/200" },
        { id: generateId(), title: "Cute Lop Rabbit", type: "Rabbit", breed: "Lop", age: 1, description: "Adorable lop-eared rabbit, perfect for small spaces.", price: 80, sellerId: "sample5", image: "https://picsum.photos/seed/rabbit1/300/200" },
        { id: generateId(), title: "White Netherland Dwarf", type: "Rabbit", breed: "Netherland Dwarf", age: 1, description: "Small and cuddly dwarf rabbit, very playful.", price: 90, sellerId: "sample6", image: "https://picsum.photos/seed/rabbit2/300/200" },
        { id: generateId(), title: "Friendly Guinea Pig", type: "Guinea Pig", breed: "American", age: 1, description: "Sociable and gentle, ideal for kids.", price: 40, sellerId: "sample7", image: "https://picsum.photos/seed/guineapig1/300/200" },
        { id: generateId(), title: "Speckled Guinea Pig", type: "Guinea Pig", breed: "Abyssinian", age: 1, description: "Colorful and active, a delightful pet.", price: 45, sellerId: "sample8", image: "https://picsum.photos/seed/guineapig2/300/200" },
        { id: generateId(), title: "Majestic Maine Coon Cat", type: "Cat", breed: "Maine Coon", age: 4, description: "Large and majestic, with a gentle nature.", price: 300, sellerId: "sample9", image: "https://picsum.photos/seed/cat3/300/200" },
        { id: generateId(), title: "British Shorthair", type: "Cat", breed: "British Shorthair", age: 3, description: "Calm and affectionate, ideal indoor pet.", price: 250, sellerId: "sample10", image: "https://picsum.photos/seed/cat4/300/200" },
        { id: generateId(), title: "Energetic Border Collie", type: "Dog", breed: "Border Collie", age: 2, description: "Smart and energetic, perfect for active owners.", price: 400, sellerId: "sample11", image: "https://picsum.photos/seed/dog3/300/200" },
        { id: generateId(), title: "Elegant Poodle", type: "Dog", breed: "Poodle", age: 3, description: "Elegant and friendly, low-shedding coat.", price: 350, sellerId: "sample12", image: "https://picsum.photos/seed/dog4/300/200" },
        { id: generateId(), title: "Charming Dutch Rabbit", type: "Rabbit", breed: "Dutch", age: 1, description: "Distinctive markings, great temperament.", price: 85, sellerId: "sample13", image: "https://picsum.photos/seed/rabbit3/300/200" },
        { id: generateId(), title: "Flemish Giant Rabbit", type: "Rabbit", breed: "Flemish Giant", age: 2, description: "Large and gentle giant, needs space to roam.", price: 120, sellerId: "sample14", image: "https://picsum.photos/seed/rabbit4/300/200" },
        { id: generateId(), title: "Active Abyssinian Cat", type: "Cat", breed: "Abyssinian", age: 3, description: "Active and curious, loves to explore.", price: 220, sellerId: "sample15", image: "https://picsum.photos/seed/cat5/300/200" },
        { id: generateId(), title: "Loyal German Shepherd", type: "Dog", breed: "German Shepherd", age: 4, description: "Protective and intelligent, excellent guard dog.", price: 550, sellerId: "sample16", image: "https://picsum.photos/seed/dog5/300/200" },
        { id: generateId(), title: "Unique Sphynx Cat", type: "Cat", breed: "Sphynx", age: 2, description: "Affectionate and distinctive, hairless beauty.", price: 280, sellerId: "sample17", image: "https://picsum.photos/seed/cat6/300/200" },
        { id: generateId(), title: "Friendly Beagle", type: "Dog", breed: "Beagle", age: 3, description: "Small, energetic, with a keen sense of smell.", price: 300, sellerId: "sample18", image: "https://picsum.photos/seed/dog6/300/200" },
        { id: generateId(), title: "Graceful Peruvian Inca Orchid", type: "Cat", breed: "Inca Orchid", age: 3, description: "Graceful and elegant, a rare breed.", price: 260, sellerId: "sample19", image: "https://picsum.photos/seed/cat7/300/200" },
        { id: generateId(), title: "Robust Guinea Pig", type: "Guinea Pig", breed: "Crested", age: 1, description: "Healthy and playful, a fun companion.", price: 50, sellerId: "sample20", image: "https://picsum.photos/seed/guineapig3/300/200" }
      ];
      savePets(sampleListings);
    }
    
    // Render listings in grid
    function renderListings() {
      populateSampleListings(); // populate if empty
      const listingsContainer = document.getElementById("listingGrid");
      const listings = getPets();
      listingsContainer.innerHTML = "";
      listings.forEach(listing => {
        const card = document.createElement("div");
        card.className = "listing-card";
        card.innerHTML = `
          <img src="${listing.image}" alt="${listing.title}">
          <div class="listing-info">
            <h3>${listing.title}</h3>
            <p>${listing.description}</p>
            <p class="price">\$${listing.price}</p>
            <p class="seller">Seller: ${listing.sellerId}</p>
          </div>
        `;
        card.addEventListener("click", () => {
          window.location.hash = "#pet-" + listing.id;
          render();
        });
        listingsContainer.appendChild(card);
      });
    }
    
    render();
  </script>
</body>
</html>
